From: Simon McVittie <smcv@debian.org>
Date: Wed, 17 Jan 2018 14:20:46 +0000
Subject: Use Python 3 for test web server

The parts of libtest.sh and tests/make-test-runtime.sh that deal with
Python 2 are unaffected: they are only used in the flatpak-builder
tests.

Forwarded: not-needed
---
 tests/test-webserver.sh | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/tests/test-webserver.sh b/tests/test-webserver.sh
index 7accd0b..2e7884d 100755
--- a/tests/test-webserver.sh
+++ b/tests/test-webserver.sh
@@ -3,7 +3,7 @@
 set -euo pipefail
 
 dir=$1
-cmd=${2:-python -m SimpleHTTPServer 0}
+cmd=${2:-python3 -m http.server 0}
 test_tmpdir=$(pwd)
 
 [ "$dir" != "" ] && cd ${dir}
@@ -19,7 +19,7 @@ for x in $(seq 300); do
     echo >&2
     # If it's non-empty, see whether it matches our regexp
     if test -s ${test_tmpdir}/httpd-output.tmp; then
-        sed -e 's,Serving HTTP on 0.0.0.0 port \([0-9]*\) \.\.\.,\1,' < ${test_tmpdir}/httpd-output.tmp > ${test_tmpdir}/httpd-port
+        sed -e 's,Serving HTTP on 0.0.0.0 port \([0-9]*\) .*,\1,' < ${test_tmpdir}/httpd-output.tmp > ${test_tmpdir}/httpd-port
         if ! cmp ${test_tmpdir}/httpd-output.tmp ${test_tmpdir}/httpd-port 1>/dev/null; then
             # If so, we've successfully extracted the port
             break
