polkit.addRule(function(action, subject) {
    if ((action.id == "org.freedesktop.Flatpak.app-install" ||
         action.id == "org.freedesktop.Flatpak.runtime-install"||
         action.id == "org.freedesktop.Flatpak.app-uninstall" ||
         action.id == "org.freedesktop.Flatpak.runtime-uninstall" ||
         action.id == "org.freedesktop.Flatpak.modify-repo") &&
        subject.active == true && subject.local == true &&
        subject.isInGroup("@privileged_group@")) {
            return polkit.Result.YES;
    } else if (action.id == "org.freedesktop.Flatpak.app-install" &&
               subject.active == true && subject.local == true &&
               action.lookup("parental-controls-repo-installation-allowed") === "1" &&
               action.lookup("parental-controls-is-appropriate") === "1") {
            return polkit.Result.YES;
    }

    return polkit.Result.NOT_HANDLED;
});
